<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Audia is a library for simplifying the Web Audio API - Lost Decade Games</title>
	<meta name="description" content="Official website of Lost Decade Games, an independent HTML5 game company in Silicon Valley, CA.">
	<meta name="keywords" content="html5 games, javascript, chrome webstore, game dev, open source, blog, git, github, lost decade games, matt hackett, richtaur, geoff blair, gosub, zylo">
	<link rel="alternate" type="application/atom+xml" title="ATOM Feed for Lost Decade Games" href="http://www.lostdecadegames.com/rss.xml">
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="stylesheet" type="text/css" href="/media/css/combo.css?v1">
</head>
<body>
	<div id="hd">
	<h1>
		<a href="/">Lost Decade Games</a>
	</h1>
	<ul id="nav">
		<li><a href="/about/">About</a></li>
		<li><a href="/lostcast/">Lostcast</a></li>
		<li><a href="http://forum.lostdecadegames.com/">Forum</a></li>
		<li><a class="focal-point" href="http://www.wizardslizard.com/">A Wizard's Lizard</a></li>
	</ul>
</div>

<ul id="social">
	<li><a class="youtube" href="http://www.youtube.com/LostDecadeGames" title="YouTube">YouTube</a></li>
	<!--li><a class="apple" href="http://itunes.apple.com/us/podcast/lostcast/id481950724" title="iTunes">iTunes</a></li-->
	<li><a class="twitter" href="https://twitter.com/LostDecadeGames" title="Twitter">Twitter</a></li>
	<li><a class="email" href="/mailing-list/" title="Mailing List">Mailing List</a></li>
	<li><a class="rss" href="/rss.xml" title="RSS">RSS</a></li>
</ul>

<!-- Author -->

	


<!-- Splash -->

	


<div class="splash laptop">
	<div>
		<h2>Audia is a library for simplifying the Web Audio API</h2>
		<em>by Matt Hackett, 2011 Oct 5</em>
	</div>
</div>

<div class="section text blog">
<p>After receiving numerous <a href="https://twitter.com/#!/lostdecadegames">requests on Twitter</a>, I started working on a tutorial for playing sound in HTML5. You may have read about <a href="http://www.phoboslab.org/log/2011/03/the-state-of-html5-audio">previous frustrations with Audio</a> from the HTML5 developer community, and when I dug in recently, the situation was all-too familiar.</p>

<h2 id="wrong-tool-for-the-job">Wrong tool for the job</h2>

<p>In the latest version of Chrome, sound playback was unreliable, bits and pieces were missing from the API, and things just did not work as expected. Safari faired better, but it still felt like <code>Audio</code> was not ready for prime time. However, I think the problem was more of using the wrong tool for the job. Games need responsive, reliable, sometimes even dynamic sound playback, and because of this, <code>Audio</code> is not the best choice for game development.</p>

<p>A good way to think about it is by comparing the <code>Image</code> and <code>Audio</code> tags. Both are simple HTML elements that really just want <code>src</code> attributes, from which they’ll fetch the media and display it in the document. For advanced image manipulation, <code>Canvas</code> is used, and for advanced audio manipulation, <code>AudioContext</code> can be used.</p>

<h2 id="enter-the-web-audio-api">Enter the Web Audio API</h2>

<p>It turns out, the Web Audio API is here today and it is pretty badass. (By “here today” I really just mean Chrome, but it exists and works great even in the <a href="http://www.chromium.org/getting-involved/dev-channel">stable channel</a>.)</p>

<p>Just about the only documentation I could find was the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">W3C Working Draft</a>, but this was enough to meet feature parity with <code>Audio</code>. Fair warning to developers looking to toy around with it: <strong>the API is extremely low-level</strong> and cumbersome to use (but quite fun if that floats your boat!).</p>

<p>Here’s what it takes to simply load up a sound file and play it:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js">if (typeof AudioContext == &quot;function&quot;) {
	var audioContext = new AudioContext();
} else if (typeof webkitAudioContext == &quot;function&quot;) {
	var audioContext = new webkitAudioContext();
}

var source = audioContext.createBufferSource();
source.connect(audioContext.destination);

var xhr = new XMLHttpRequest();
xhr.open(&quot;GET&quot;, &quot;your_sound_file.mp3&quot;, true);
xhr.responseType = &quot;arraybuffer&quot;;
xhr.onload = function() {
	var buffer = audioContext.createBuffer(xhr.response, false);
	source.buffer = buffer;
	source.noteOn(0);
};
xhr.send();</code></pre></div>

<p>That’s a lot of code! Let’s walk through it.</p>

<h3 id="create-an-instance-of-audiocontext">1. Create an instance of AudioContext</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js">if (typeof AudioContext == &quot;function&quot;) {
	var audioContext = new AudioContext();
} else if (typeof webkitAudioContext == &quot;function&quot;) {
	var audioContext = new webkitAudioContext();
}</code></pre></div>

<p>Since this is bleeding-edge technology, we can’t guarantee that <code>AudioContext</code> exists. Indeed, Chrome currently has the <code>webkitAudioContext</code> object (an experimental implementation). So before we can create a new instance we first have to check to see what we have available.</p>

<h3 id="create-a-buffer-source-and-connect-it-to-the-audio-output">2. Create a buffer source and connect it to the audio output</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js">var source = audioContext.createBufferSource();
source.connect(audioContext.destination);</code></pre></div>

<p>We request to create a buffer source and store it in the <code>source</code> variable. Then we connect the source to the audio context’s <code>destination</code> property, which will hopefully be our computer’s speakers!</p>

<h3 id="fetch-the-mp3-file">3. Fetch the mp3 file</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js">var xhr = new XMLHttpRequest();
xhr.open(&quot;GET&quot;, &quot;your_sound_file.mp3&quot;, true);
xhr.responseType = &quot;arraybuffer&quot;;
xhr.onload = function() {
	// See step 4
};
xhr.send();</code></pre></div>

<p>This might be a tad unexpected for JavaScript programmers who are accustomed to simply setting a property on an HTML node (for example. <code>myAudio.src = "my_sound.mp3";</code>), but to fetch our sound file we need to do it via an <code>XMLHttpRequest</code> object. This is basic AJAXy stuff, aside from needing to set <code>responseType</code> to “arraybuffer”.</p>

<h3 id="create-the-sound-buffer-and-play-the-sound">4. Create the sound buffer and play the sound</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js">var buffer = audioContext.createBuffer(xhr.response, false);
source.buffer = buffer;
source.noteOn(0);</code></pre></div>

<p>This code makes up the contents of the above <code>XMLHttpRequest</code> object’s <code>onload</code> method. First we create a buffer, passing in the XHR response and <code>false</code>. (That second parameter is “mixToMono”, and we don’t necessarily want our sound in mono, so we pass in <code>false</code>.) This buffer gets passed to the source by setting its <code>buffer</code> property.</p>

<p>Next, there’s a call to the odd method <code>noteOn</code>. In simpler English, this would be <code>play</code>, but what is going on behind the scenes is much more complicated. The argument represents the time (in seconds) to begin playback. To make our playback begin immediately, we pass <code>0</code>.</p>

<p>Pretty involved just to play a sound, right? But the reward is well worth it, because now we have low-level access to our computer’s sound and can implement <a href="http://chromium.googlecode.com/svn/trunk/samples/audio/">all kinds of goodies</a> like panning, filters and other neat effects.</p>

<h2 id="introducing-audia">Introducing Audia</h2>

<p><em><a href="/demos/audia/examples/">Jump straight to the demo?</a></em></p>

<p>While experimenting with this new API, I quickly discovered that a library to abstract away all this complication would be nice to have, so I wrote one. Here is what I call <a href="https://github.com/richtaur/audia">Audia</a>, which implements a very <a href="https://github.com/richtaur/audia#readme">straightforward API</a> while still providing some of the power of the Web Audio API. Here’s an example of how it can be used:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js">if (!Audia.supported) {
	alert(&quot;Oops, no AudioContext object found ...&quot;);
}

var attackSound = new Audia();
attackSound.onload = function () {
	attackSound.play();
};
attackSound.src = &quot;audio/demoblin_attacks.mp3&quot;;</code></pre></div>

<p>Or alternatively:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js">var backgroundMusic = new Audia({
	src: &quot;sewers.mp3&quot;,
	loop: true,
	volume: 0.5
});</code></pre></div>

<p>Audio (especially as pertains to video games) is a little hobby of mine, so you can bet I’ll be exposing more of the power behind the Web Audio API to <a href="https://github.com/richtaur/audia">Audia</a>’s simple interface. So do <a href="/demos/audia/examples/">check out the demo</a> and let me know in the comments about any issues, feature requests, etc.</p>



	<p>
		<a class="download-podcast" href="http://twitter.com/richtaur">Follow author @richtaur</a>
	</p>
</div>

<div class="section text">
	
		<div class="module">
	<!-- Begin Disqus comments -->
	<div id="disqus_thread"></div>
	<script type="text/javascript">
		var disqus_shortname = "lostdecadegames";
		var disqus_identifier = "/audia-is-a-library-for-simplifying-the-web-audio-api";
		var disqus_url = "http://www.lostdecadegames.com/audia-is-a-library-for-simplifying-the-web-audio-api";
		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<!-- End Disqus comments -->
</div>

	
</div>


<div id="ft">
	<p>
		Lost Decade Games © 2015
		• <a href="/blog/">Blog</a>
		• <a href="/about/tos/">Terms of Service</a>
		• <a href="/about/video-policy/">Video Policy</a>
	</p>
</div>

	<!-- Begin Google Analytics -->
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16927444-7']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
<!-- End Google Analytics -->

</body>
</html>
